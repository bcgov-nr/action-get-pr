name: Test

on:
  merge_group:
  push:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # Dump GitHub Context.Event
  dump:
    name: Dump GitHub Context.Event
    runs-on: ubuntu-22.04
    steps:
      - name: Dump GitHub Context.Event
        run: echo "${{ toJson(github.event) }}" | sed -r 's/#/\\#/g'
  
  # Test for PR, merge queue and merge to main
  test:
    name: Get PR number
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
      - id: vars
        uses: ./
        
      - name: Verify PR number
        run: |
          set -eux
          # Check
          if [ -z ${{ steps.vars.outputs.pr }} ]
          then
            echo "No PR number"
            exit 1
          fi
          echo "PR: ${{ steps.vars.outputs.pr }}"
